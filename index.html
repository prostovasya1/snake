<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>üêç Snake Game - gamesnakes.io</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      color: #eee;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      user-select: none;
      touch-action: none;
      overflow-x: hidden;
    }
    
    /* üéÆ INTRO SCREEN - Clean & Welcoming */
    .intro-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 300;
      animation: fadeIn 0.5s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    .intro-title {
      font-size: clamp(2rem, 8vw, 4rem);
      background: linear-gradient(45deg, #4caf50, #76ff03, #66bb6a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 20px;
      text-align: center;
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { filter: drop-shadow(0 0 10px #4caf50); }
      to { filter: drop-shadow(0 0 20px #76ff03); }
    }
    
    .intro-btn {
      background: linear-gradient(145deg, #4caf50, #45a049);
      color: white;
      border: none;
      padding: 18px 40px;
      font-size: clamp(1.1rem, 5vw, 1.4rem);
      font-weight: 700;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(76,175,80,0.4);
      transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .intro-btn:hover, .intro-btn:active {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(76,175,80,0.6);
    }
    
    /* üèÜ MAIN GAME LAYOUT */
    .game-ui {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 500px;
      padding: 20px;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
    }
    @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }
    
    h1 {
      font-size: clamp(1.8rem, 6vw, 2.8rem);
      margin-bottom: 12px;
      text-align: center;
      background: linear-gradient(45deg, #4caf50, #76ff03);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* ‚úÖ SCORE OUTSIDE - Top Center */
    .score {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: clamp(1.2rem, 5vw, 1.6rem);
      font-weight: 800;
      color: #4caf50;
      text-shadow: 0 0 20px #4caf50, 0 2px 10px rgba(0,0,0,0.8);
      background: rgba(18,18,18,0.9);
      padding: 12px 24px;
      border-radius: 20px;
      backdrop-filter: blur(20px);
      border: 2px solid rgba(76,175,80,0.4);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      margin-bottom: 12px;
      z-index: 100;
    }
    
    .game-container {
      position: relative;
      width: min(95vw, 95vh, 450px);
      height: min(95vw, 95vh, 450px);
      aspect-ratio: 1;
      border: 4px solid #333;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 16px 50px rgba(0,0,0,0.7);
      background: #1a1a1a;
      margin: 0 auto;
    }
    
    canvas { 
      display: block; 
      width: 100%; 
      height: 100%; 
      image-rendering: pixelated;
      image-rendering: -webkit-optimize-contrast;
    }
    
    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(25px);
      padding: 32px 40px;
      border-radius: 24px;
      text-align: center;
      display: none;
      flex-direction: column;
      gap: 24px;
      box-shadow: 0 25px 70px rgba(0,0,0,0.9);
      z-index: 200;
      border: 2px solid #ff5252;
      max-width: 90%;
      animation: fadeIn 0.4s ease-out;
    }
    
    .game-over h2 { 
      color: #ff5252; 
      margin: 0;
      font-size: clamp(1.5rem, 7vw, 2.4rem);
      text-shadow: 0 0 20px #ff5252;
    }
    
    .controls { 
      margin-top: 16px; 
      font-size: clamp(0.9rem, 3.5vw, 1.1rem); 
      color: #aaa; 
      text-align: center;
      opacity: 0.8;
    }

    /* üì± MOBILE D-PAD - Cleaner & Smaller */
    .mobile-controls {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      z-index: 150;
      pointer-events: all;
    }
    .dpad {
      display: grid;
      grid-template-areas: 
        ". up ."
        "left center right"
        ". down .";
      grid-template-columns: 1fr 60px 1fr;
      grid-template-rows: 1fr 60px 1fr;
      gap: 6px;
      width: 180px;
      height: 180px;
      padding: 16px;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }
    .mobile-btn {
      border-radius: 16px;
      background: linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
      border: 1.5px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(15px);
      transition: all 0.12s;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .mobile-btn:active {
      transform: scale(0.9);
      background: linear-gradient(145deg, rgba(255,255,255,0.25), rgba(255,255,255,0.12));
      border-color: rgba(255,255,255,0.4);
    }
    #up { grid-area: up; height: 60px; width: 60px; }
    #left { grid-area: left; height: 60px; width: 60px; }
    #right { grid-area: right; height: 60px; width: 60px; }
    #down { grid-area: down; height: 60px; width: 60px; }
    #center { 
      grid-area: center; 
      background: rgba(76,175,80,0.25) !important;
      border-color: rgba(76,175,80,0.5) !important;
      font-size: 1.3rem;
      pointer-events: none;
    }

    @media (max-width: 768px) {
      .game-ui { padding: 15px; }
      .mobile-controls { display: block; }
      .controls { display: none; }
      .dpad { width: 200px; height: 200px; padding: 18px; }
    }
    @media (orientation: landscape) and (max-height: 500px) {
      body { flex-direction: row; padding: 15px; }
      .game-container { width: 65vh; height: 65vh; }
      .mobile-controls { bottom: 15px; right: 15px; left: auto; transform: none; }
    }
  </style>
</head>
<body>
  <!-- üéÆ NEW INTRO SCREEN -->
  <div class="intro-screen" id="introScreen">
    <div class="intro-title">üêç SNAKE</div>
    <button class="intro-btn" id="startBtn">‚ñ∂Ô∏è Play</button>
  </div>

  <!-- üèÜ MAIN GAME -->
  <div class="game-ui">
    <h1>üêç Snake</h1>
    <div class="score">Score: <span id="score">0</span></div>
    <div class="game-container">
      <canvas id="gameCanvas"></canvas>
      <div class="game-over" id="gameOver">
        <h2>Game Over!</h2>
        <p>Your score: <strong id="finalScore">0</strong></p>
        <button id="restartBtn">üîÑ Play Again</button>
      </div>
    </div>
    <div class="controls">
      Swipe or Arrows / WASD
    </div>
  </div>

  <!-- üì± D-PAD -->
  <div class="mobile-controls">
    <div class="dpad">
      <button class="mobile-btn" id="up">‚Üë</button>
      <button class="mobile-btn" id="left">‚Üê</button>
      <button class="mobile-btn" id="center">üêç</button>
      <button class="mobile-btn" id="right">‚Üí</button>
      <button class="mobile-btn" id="down">‚Üì</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const gameOverScreen = document.getElementById('gameOver');
    const finalScoreEl = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');
    const introScreen = document.getElementById('introScreen');
    const startBtn = document.getElementById('startBtn');
    const gameUI = document.querySelector('.game-ui');

    // üêõ RESPONSIVE + BUG-FREE SIZING
    function resizeCanvas() {
      const size = Math.min(window.innerWidth * 0.92, window.innerHeight * 0.7, 450);
      canvas.width = Math.floor(size);
      canvas.height = Math.floor(size);
      updateTileCount();
    }
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', () => setTimeout(resizeCanvas, 150));

    const gridSize = 20;
    let tileCount = 20;
    let snake = [{ x: 10, y: 10 }];
    let food = {};
    let dx = 0, dy = 0;
    let score = 0;
    let gameLoop;
    let gameRunning = false;

    function updateTileCount() {
      tileCount = Math.floor(canvas.width / gridSize);
    }

    function generateFood() {
      let x, y;
      do {
        x = 2 + Math.floor(Math.random() * (tileCount - 4)); // Safe: 2 to tileCount-3
        y = 2 + Math.floor(Math.random() * (tileCount - 4));
      } while (snake.some(s => s.x === x && s.y === y));
      return { x, y };
    }

    // üêõ PERFECT COLLISION DETECTION
    function isValidMove(newHead) {
      // Wall: 0 to tileCount-1 inclusive
      if (newHead.x < 0 || newHead.x >= tileCount || newHead.y < 0 || newHead.y >= tileCount) {
        return false;
      }
      // Self: check body AFTER adding head
      return !snake.some((s, i) => i > 0 && s.x === newHead.x && s.y === newHead.y);
    }

    function init() {
      resizeCanvas(); // Ensure fresh size
      const startX = Math.floor(tileCount / 2);
      const startY = Math.floor(tileCount / 2);
      snake = [{ x: startX, y: startY }];
      food = generateFood();
      dx = 0; dy = 0;
      score = 0;
      scoreEl.textContent = score;
      gameOverScreen.style.display = 'none';
      gameRunning = true;
      if (gameLoop) clearInterval(gameLoop);
      gameLoop = setInterval(draw, Math.max(90, 160 - score * 1.5));
    }

    function draw() {
      if (!gameRunning) return;

      const head = { x: snake[0].x + dx, y: snake[0].y + dy };

      // üêõ FIXED: Check collision BEFORE moving
      if (!isValidMove(head)) {
        endGame();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.textContent = score;
        food = generateFood();
      } else {
        snake.pop();
      }

      // Clear + subtle grid
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Grid lines (inside bounds only)
      ctx.strokeStyle = 'rgba(255,255,255,0.04)';
      ctx.lineWidth = 1;
      for (let i = 1; i < tileCount; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize, 0);
        ctx.lineTo(i * gridSize, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, i * gridSize);
        ctx.lineTo(canvas.width, i * gridSize);
        ctx.stroke();
      }

      // ‚ú® Glowing food
      const fx = food.x * gridSize + gridSize / 2;
      const fy = food.y * gridSize + gridSize / 2;
      const r = gridSize / 2 - 1;
      const glow = ctx.createRadialGradient(fx, fy, 0, fx, fy, r * 1.5);
      glow.addColorStop(0, '#ff6b6b');
      glow.addColorStop(0.6, '#ff5252');
      glow.addColorStop(1, 'rgba(204,0,0,0.5)');
      ctx.fillStyle = glow;
      ctx.beginPath();
      ctx.arc(fx, fy, r, 0, Math.PI * 2);
      ctx.fill();

      // üêç Snake
      snake.forEach((part, i) => {
        const x = part.x * gridSize + 2;
        const y = part.y * gridSize + 2;
        const w = gridSize - 4;
        const h = gridSize - 4;
        const isHead = i === 0;
        const grad = ctx.createRadialGradient(
          part.x * gridSize + gridSize/2, part.y * gridSize + gridSize/2, 0,
          part.x * gridSize + gridSize/2, part.y * gridSize + gridSize/2, gridSize/2
        );
        grad.addColorStop(0, isHead ? '#76ff03' : '#66bb6a');
        grad.addColorStop(1, isHead ? '#4caf50' : '#43a047');
        ctx.fillStyle = grad;
        ctx.fillRect(x, y, w, h);
        ctx.strokeStyle = '#16262e';
        ctx.lineWidth = 1;
        ctx.strokeRect(x, y, w, h);
      });
    }

    function endGame() {
      gameRunning = false;
      clearInterval(gameLoop);
      finalScoreEl.textContent = score;
      gameOverScreen.style.display = 'flex';
    }

    function changeDirection(newDx, newDy) {
      if (!gameRunning || (newDx === -dx && newDy === -dy)) return;
      dx = newDx;
      dy = newDy;
    }

    // üéÆ CONTROLS
    startBtn.addEventListener('click', init);
    startBtn.addEventListener('touchend', e => { e.preventDefault(); init(); });
    restartBtn.addEventListener('click', init);
    restartBtn.addEventListener('touchend', e => { e.preventDefault(); init(); });

    document.addEventListener('keydown', e => {
      e.preventDefault();
      const key = e.key.toLowerCase();
      if (key === 'arrowup' || key === 'w') changeDirection(0, -1);
      if (key === 'arrowdown' || key === 's') changeDirection(0, 1);
      if (key === 'arrowleft' || key === 'a') changeDirection(-1, 0);
      if (key === 'arrowright' || key === 'd') changeDirection(1, 0);
    });

    // Touch swipe
    let touchStart = { x: 0, y: 0 };
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }, { passive: false });
    canvas.addEventListener('touchend', e => {
      e.preventDefault();
      const deltaX = e.changedTouches[0].clientX - touchStart.x;
      const deltaY = e.changedTouches[0].clientY - touchStart.y;
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 40) {
        changeDirection(deltaX > 0 ? 1 : -1, 0);
      } else if (Math.abs(deltaY) > 40) {
        changeDirection(0, deltaY > 0 ? 1 : -1);
      }
    }, { passive: false });

    // D-Pad
    ['up', 'down', 'left', 'right'].forEach(dir => {
      document.getElementById(dir).addEventListener('touchstart', e => {
        e.preventDefault();
        if (dir === 'up') changeDirection(0, -1);
        if (dir === 'down') changeDirection(0, 1);
        if (dir === 'left') changeDirection(-1, 0);
        if (dir === 'right') changeDirection(1, 0);
      }, { passive: false });
    });

    canvas.addEventListener('click', init);

    // üêõ INIT: Hide intro, show game
    resizeCanvas();
    food = generateFood();
  </script>
</body>
</html>
